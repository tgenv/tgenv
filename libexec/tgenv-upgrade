# #!/usr/bin/env bash

##########################################
#
# This script just works like a software
# version updater. It's a shortcut to
# $ git checkout master && git pull
#
##########################################

set -e
[ -n "${TGENV_DEBUG}" ] && set -x
initial_dir=$(pwd)
source "${TGENV_ROOT}/libexec/helpers"

debug "Changing directory to ${TGENV_ROOT}"
cd "${TGENV_ROOT}"

current_branch=$(git rev-parse --abbrev-ref HEAD)
debug "Current branch is ${current_branch}"

# If branch it was different of main executes the checkout them
if [ "${current_branch}" != 'main' ]; then
   # NOTE(simonm) wondering whether the default behavior should be for us to do this for the user
   # or just to exit and tell them that they need to be on a clean branch first.
   warn_and_continue "Current branch is not main. Stashing changes and checking out main"
   git -q stash
   git -q checkout main
fi

git -q pull

debug "Changing directory to ${initial_dir}"
cd "${initial_dir}"

git -C log -1
